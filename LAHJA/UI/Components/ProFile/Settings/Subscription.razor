
@using LAHJA.Data.UI.Components.Plan
@using LAHJA.Helpers.Services
@using LAHJA.UI.Components.Plan
@inject LanguageService languageService
@inject IManageLanguageService _manageLanguageService
@inject LAHJA.Data.UI.Templates.Profile.TemplateProfile Template
@inject NavigationManager Navigation


@* @if (Template != null)
{
	<Subscription DataBuild="buildData" />
} *@

<main class="flex flex-1 flex-col">
@* 	<ResendConfirmationemail /> *@

	<div class="container relative max-w-full flex-1 from-pink-100 via-green-100 to-yellow-100 md:bg-gradient-to-br md:pb-12 md:pt-8 md:dark:from-gray-900 md:dark:to-gray-925">
		<section class="col-span-full mx-auto max-w-2xl flex-1 overflow-hidden bg-white md:rounded-xl md:shadow">
			<div class="flex h-40 items-center justify-center bg-gradient-to-t from-gray-100 via-white to-white dark:from-gray-925 dark:to-gray-800">
				<h1 class="mr-3 text-xl font-bold text-gray-800 sm:text-2xl md:-mt-3">
					<span class="mr-3">👷</span>Subscribe to Pro
				</h1>
			</div>

			@if(_dataBuild != null && _dataBuild.Count()>0){

				@foreach (var item in _dataBuild)
				{
					<MudContainer  Class="p-3">
						<TemplatePlan Params="item" SubmitUpgrade="OnSubmitUpgradePlan" IsUpgrade="true" AllowUpdate="true" IsDisplaySelectButton="false" IsExpanded="true" />
					</MudContainer>
				}

			
			}
			
		@* 	<div class="SVELTE_HYDRATER contents" data-target="UserSubscriptionForm" data-props="{&quot;isUserAuth&quot;:true,&quot;next&quot;:null,&quot;theme&quot;:&quot;light&quot;}">
				<div>
					<div class="alert alert-error whitespace-pre-wrap !rounded-t-none">Error: Your primary email must be confirmed to access paid features.</div> <div class="py-4">
						<div class="flex h-40 w-full items-center justify-center">
							<svg class="animate-spin mr-2" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="none" focusable="false" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
							Initializing Payment...
						</div>
					</div>
				</div>
			</div> *@
		</section>
	</div>
</main>

@code{


	[Parameter] public List<SubscriptionPlanInfo> DataBuild { get => _dataBuild; set => _dataBuild = value; }

	private List<SubscriptionPlanInfo> _dataBuild = new List<SubscriptionPlanInfo>();

	private  string CurrentLanguage = "ar";
	protected override void OnInitialized()
	{

		languageService.OnLanguageChanged += ChangeLanguage;
		ChangeLanguage(CurrentLanguage);

	}
	protected override async Task OnAfterRenderAsync(bool firstRender)
	{

		if (firstRender)
		{
			if (firstRender)
			{
				CurrentLanguage = await _manageLanguageService.GetLanguageAsync();
				InvokeAsync(StateHasChanged);
			}

			var result = await Template.GetUserSubscriptionsPlanAsync();

			if (result.Succeeded)
			{
				_dataBuild = result.Data.ToList();

			}

		}

		StateHasChanged();

	}
	private void ChangeLanguage(string language)
	{
		CurrentLanguage = language;
		InvokeAsync(StateHasChanged);
	}


	private void OnSubmitUpgradePlan(SubscriptionPlanInfo plan)
	{
		Navigation.NavigateTo("/payment/"+plan.Id);
	}

}